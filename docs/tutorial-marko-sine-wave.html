<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Tutorial: marko-sine-wave - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="duil.Widget.html">Widget</a><ul class='methods'><li data-type='method'><a href="duil.Widget.html#init">init</a></li><li data-type='method'><a href="duil.Widget.html#render">render</a></li><li data-type='method'><a href="duil.Widget.html#set">set</a></li><li data-type='method'><a href="duil.Widget.html#on">on</a></li><li data-type='method'><a href="duil.Widget.html#off">off</a></li><li data-type='method'><a href="duil.Widget.html#trigger">trigger</a></li><li data-type='method'><a href="duil.Widget.html#invoke">invoke</a></li></ul></li><li><a href="duil.Group.html">Group</a><ul class='methods'><li data-type='method'><a href="duil.Group.html#.KEY_BY_ID">KEY_BY_ID</a></li><li data-type='method'><a href="duil.Group.html#key">key</a></li><li data-type='method'><a href="duil.Group.html#create">create</a></li><li data-type='method'><a href="duil.Group.html#update">update</a></li><li data-type='method'><a href="duil.Group.html#remove">remove</a></li><li data-type='method'><a href="duil.Group.html#render">render</a></li><li data-type='method'><a href="duil.Group.html#drain">drain</a></li><li data-type='method'><a href="duil.Group.html#init">init</a></li><li data-type='method'><a href="duil.Group.html#set">set</a></li><li data-type='method'><a href="duil.Group.html#on">on</a></li><li data-type='method'><a href="duil.Group.html#off">off</a></li><li data-type='method'><a href="duil.Group.html#trigger">trigger</a></li><li data-type='method'><a href="duil.Group.html#invoke">invoke</a></li></ul></li><li><a href="duil.List.html">List</a><ul class='methods'><li data-type='method'><a href="duil.List.html#init">init</a></li><li data-type='method'><a href="duil.List.html#key">key</a></li><li data-type='method'><a href="duil.List.html#create">create</a></li><li data-type='method'><a href="duil.List.html#update">update</a></li><li data-type='method'><a href="duil.List.html#remove">remove</a></li><li data-type='method'><a href="duil.List.html#render">render</a></li><li data-type='method'><a href="duil.List.html#drain">drain</a></li><li data-type='method'><a href="duil.List.html#set">set</a></li><li data-type='method'><a href="duil.List.html#on">on</a></li><li data-type='method'><a href="duil.List.html#off">off</a></li><li data-type='method'><a href="duil.List.html#trigger">trigger</a></li><li data-type='method'><a href="duil.List.html#invoke">invoke</a></li></ul></li><li><a href="Queue.html">Queue</a><ul class='methods'><li data-type='method'><a href="Queue.html#isEmpty">isEmpty</a></li><li data-type='method'><a href="Queue.html#add">add</a></li><li data-type='method'><a href="Queue.html#peek">peek</a></li><li data-type='method'><a href="Queue.html#get">get</a></li><li data-type='method'><a href="Queue.html#set">set</a></li></ul></li></ul><h3>Externals</h3><ul><li><a href="external-_jQuery.fn_.html">jQuery.fn</a><ul class='methods'><li data-type='method'><a href="external-_jQuery.fn_.html#.set">set</a></li></ul></li></ul><h3>Events</h3><ul><li><a href="duil.html#event:init">init</a></li><li><a href="duil.html#event:render">render</a></li><li><a href="duil.html#event:change">change</a></li><li><a href="duil.html#event:create">create</a></li><li><a href="duil.html#event:update">update</a></li><li><a href="duil.html#event:remove">remove</a></li></ul><h3>Namespaces</h3><ul><li><a href="duil.html">duil</a><ul class='members'><li data-type='member'><a href="duil.html#.version">version</a></li></ul><ul class='methods'><li data-type='method'><a href="duil.html#.diff">diff</a></li><li data-type='method'><a href="duil.html#.merge">merge</a></li></ul></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-benchmark-image.html">benchmark-image</a></li><li><a href="tutorial-fabric-squares.html">fabric-squares</a></li><li><a href="tutorial-marko-button.html">marko-button</a></li><li><a href="tutorial-marko-sine-wave.html">marko-sine-wave</a></li><li><a href="tutorial-react-external-plugins.html">react-external-plugins</a></li><li><a href="tutorial-react-hello-world.html">react-hello-world</a></li><li><a href="tutorial-react-simple-component.html">react-simple-component</a></li><li><a href="tutorial-react-stateful-component.html">react-stateful-component</a></li><li><a href="tutorial-react-todo-application.html">react-todo-application</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">Tutorial: marko-sine-wave</h1>
    

    <section>

<header>
    

    <h2>marko-sine-wave</h2>
</header>

<article>
    <!doctype html>
<html><head>
<title>marko sine wave in duil</title>
<style>
/* From: https://github.com/marko-js/markojs-website/blob/master/routes/index/components/sine-wave/index.marko */
.animated-sin-wave {
    position: relative;
    height: 150px;
    width: 100%;
    overflow: hidden;
}

.animated-sin-wave > .bar {
    position: absolute;
    height: 100%;
    border-radius: 50%;
    max-width:10px;
}

.animated-sin-wave-description {
    width:100%;
    text-align:center;
    font-size:0.8em;
    color:#747678;
    padding: 2em
}
</style>
</head><body>
  <div>
    <a href="https://github.com/metaist/duil.js/blob/master/tutorials/marko-sine-wave.html">view code</a>
    (<a href="https://github.com/marko-js/markojs-website/blob/master/routes/index/components/sine-wave/index.marko">original</a>)
    <hr />
  </div>

  <div class="animated-sin-wave" id="sine-wave-animation">
    <div class="bar"></div>
  </div>

  <p class="animated-sin-wave-description">
    The above animation is <span class="barCount"></span>
    <code>&lt;div></code> tags.
    No SVG, no CSS transitions/animations.
    It's all powered by <strike>Marko</strike> duil which does a full re-render
    every frame.
  </p>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/duil/dist/duil.min.js"></script>
<script>
//From: https://github.com/marko-js/markojs-website/blob/master/util/isElementInViewport.js
function elementInRange(x, a, b) {
  return x >= a && x <= b;
}

function isElementInViewport(element, options) {
  const scrollY = window.scrollY;
  const scrollBottom = scrollY + window.innerHeight;
  const elOffsetTop = element.offsetTop;
  const elBottomPos = elOffsetTop + element.offsetHeight;
  return (
    elementInRange(elOffsetTop, scrollY, scrollBottom) ||
    elementInRange(elBottomPos, scrollY, scrollBottom)
  );
}
// end: isElementInViewport.js

// Based on: https://github.com/marko-js/markojs-website/blob/master/routes/index/components/sine-wave/index.marko
let barCount;
let barWidth;

new duil.List({
  $dom: $('.animated-sin-wave'),
  selector: '.bar',
  data: [],

  state: {
    active: false,
    count: 0,
  },

  step: 0.5,

  // @override
  update: function (view, model, i) {
    const count = this.state.count;

    const translateY = Math.sin(count/10 + i/5) * 100 * .5;
    const hue = (360/barCount * i - count) % 360;
    const color = 'hsl('+hue+',95%,55%)';
    const rotation = (count+i)%360;
    const barX = barWidth * i;

    $(view).css({
      width: `${barWidth}%`,
      left: `${barX}%`,
      transform:
        `scale(0.8,.5) translateY(${translateY}%) rotate(${rotation}deg)`,
      backgroundColor: color
    });

    return view;
  },

  // duil-related: move handlers
  init: function () {
    this.$dom.on('click', this.switchDirection);
    this.invoke(duil.List, 'init'); // extract the template
    this.onMount(); // call marko's onMount
    return this;
  },
  onMount: function () {
    this.nextFrame = this.nextFrame.bind(this);
    $(window).resize(() => this.scale());
    this.registerAnimationViewListener();
    this.scale();

    if (this.shouldShowAnimation()) {
      this.start();
    }
  },
  scale: function () {
    barCount = Math.min(200, Math.floor(window.innerWidth / 15));
    barWidth = 100 / barCount;

    // duil-related: update the text of the div and resize the data array
    $('.barCount').text(barCount);
    this.set({data: Array(barCount).fill(0)});
  },
  start: function () {
    if (!this.state.active) {
      this.state.active = true;
      this.nextFrame();
    }
  },
  stop: function() {
    this.state.active = false;
  },
  switchDirection: function() {
    this.step *= -1;
  },
  nextFrame: function() {
    if (this.state.active) {
      // duil needs to see a change in data, but we can just call update
      this.data.forEach((_, i) => this.update(this.views[i], null, i));

      this.state.count += this.step;
      window.requestAnimationFrame(this.nextFrame);
    }
  },
  registerAnimationViewListener: function() {
    $(window).scroll(() => {
      const inView = this.shouldShowAnimation();
      if (!inView) {
        this.stop();
      } else if (inView && this.state.active === false) {
        this.start();
      }
    });
  },
  shouldShowAnimation: function() {
    const el = this.$dom[0];
    return isElementInViewport(el);
  }
});
</script>
</body></html>

</article>

</section>

</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>